<?php

require_once PATH_CODE . '/include/sql_access/DBConnect.php';

/**
 * Installs the tables needed for Babesk into the Database
 * @author Pascal Ernst <pascal.cc.ernst@googlemail.com>
 *
 */
class DBBabeskInstallation {

	////////////////////////////////////////////////////////////////////////////////
	//Attributes
	////////////////////////////////////////////////////////////////////////////////
	private $_dbConnection;
	private $_dbInstallInformationXML;

	////////////////////////////////////////////////////////////////////////////////
	//Constructor
	////////////////////////////////////////////////////////////////////////////////
	public function __construct ($host, $username, $password, $databaseName) {

		$this->_dbConnection = new DBConnect($host, $username, $password, $databaseName);
		$this->_dbInstallInformationXML = simplexml_load_file(__DIR__ . '/tablesToInstall.xml');
	}

	////////////////////////////////////////////////////////////////////////////////
	//Getters and Setters
	////////////////////////////////////////////////////////////////////////////////

	////////////////////////////////////////////////////////////////////////////////
	//Methods
	////////////////////////////////////////////////////////////////////////////////
	public function setupDatabase () {
		
		foreach($this->_dbInstallInformationXML->table as $table) {
			$this->installTable($table);
		}
	}

	////////////////////////////////////////////////////////////////////////////////
	//Implementations
	////////////////////////////////////////////////////////////////////////////////
	private function installTable ($simpleXMLElementTable) {

		$db = $this->_dbConnection->getDatabase();
		$result = $db->query((string) $simpleXMLElementTable->sqlString);

		if (!$result) {
			throw new Exception(sprintf('Error adding the table "%s" with the sqlString "%s"',
				$simpleXMLElementTable->name, $simpleXMLElementTable->sqlString));
		}
	}

}
?>